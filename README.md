# Autonomous CI/CD Healing Agent

A full-stack autonomous repair system that:
- accepts a GitHub repository URL,
- discovers and classifies failures,
- applies targeted fixes across multiple languages,
- commits/pushes fixes to a policy-compliant branch,
- polls GitHub Actions status,
- and returns a complete run report to a React dashboard.

## What this project includes

- **Backend API** (`FastAPI`) for run lifecycle management
- **Agent orchestration** (`LangGraph`) for classify → generate → verify flow
- **Static + parser-based failure detection**
- **Automatic patch application** for:
	- Python (`.py`)
	- Java (`.java`)
	- JavaScript (`.js`)
	- TypeScript (`.ts`)
- **Sandboxed test execution** via Docker (with fallback if Docker unavailable)
- **Frontend dashboard** (`React + Vite + Recharts`) with:
	- Input Section
	- Run Summary Card
	- Score Breakdown Panel
	- Fixes Applied Table
	- CI/CD Status Timeline

## Repository structure

```text
.
├─ backend/
│  ├─ app/
│  │  ├─ agents/        # LangGraph flow + agent stages
│  │  ├─ core/          # policy + scoring
│  │  ├─ models/        # API schemas
│  │  └─ services/      # runner, analyzers, patchers, git ops, storage, test engine
│  ├─ data/             # runtime outputs (ignored by git)
│  ├─ workspaces/       # cloned target repos per run (ignored by git)
│  ├─ requirements.txt
│  └─ Dockerfile
├─ frontend/
│  ├─ src/
│  │  ├─ components/
│  │  ├─ context/
│  │  └─ utils/
│  ├─ package.json
│  └─ vite.config.js
├─ docs/
│  ├─ ARCHITECTURE.md
│  ├─ API.md
│  ├─ DEVELOPMENT.md
│  └─ SANDBOX_EXECUTION.md
├─ samples/
│  └─ results.json
└─ docker-compose.yml
```

## Prerequisites

- **Python 3.11+** (3.12 recommended)
- **Node.js 20+**
- **Docker Desktop / Docker Engine** (recommended for sandboxed execution)
- A **GitHub Personal Access Token** with repository push and Actions-read capability for target repos

## Environment configuration

### Backend (`backend/.env`)

Copy `backend/.env.example` to `backend/.env` and set values:

```env
GITHUB_TOKEN=ghp_xxx
GITHUB_OWNER=owner
GITHUB_REPO=repo
DEFAULT_RETRY_LIMIT=5
```

Notes:
- `GITHUB_TOKEN` is the critical value for cloning/pushing and workflow polling.
- `GITHUB_OWNER` / `GITHUB_REPO` are optional metadata in current code paths.

### Frontend (`frontend/.env`)

Copy `frontend/.env.example` to `frontend/.env`:

```env
VITE_API_BASE=http://127.0.0.1:8000
```

## Run locally

### 1) Start backend

```bash
cd backend
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
copy .env.example .env
uvicorn app.main:app --port 8000
```

### 2) Start frontend

```bash
cd frontend
npm install
npm run dev
```

- Frontend: `http://localhost:5173`
- Backend: `http://127.0.0.1:8000`

## Run with Docker Compose

```bash
docker compose up --build
```

Services:
- Backend on `:8000`
- Frontend on `:5173`

## API endpoints

### `GET /health`
Returns service liveness.

### `POST /api/runs`
Creates and starts a new run.

Request body:
```json
{
	"repository_url": "https://github.com/owner/repo",
	"team_name": "My Team",
	"team_leader_name": "Leader",
	"retry_limit": 5
}
```

### `GET /api/runs/{run_id}`
Returns full run state including summary, score, fixes, timeline, and errors.

### `POST /api/runs/{run_id}/resume`
Resumes execution for an existing run with a new request payload.

See [docs/API.md](docs/API.md) for full payload schemas.

## Runtime behavior and policy

### Branch naming policy
Generated by `backend/app/core/policy.py`:

```text
TEAM_NAME_LEADER_NAME_AI_Fix
```

Rules:
- uppercase normalization,
- spaces and hyphens converted to underscores,
- special characters removed,
- multiple underscores collapsed.

### Commit message policy
- All commits are enforced to start with `[AI-AGENT]`.
- Runner refuses to push directly to `main`.

### Retry and timeline
- `retry_limit` range: `1..20` (default `5`).
- Each CI cycle appends a timeline event with iteration, status, and timestamp.

### Scoring model
Implemented in `backend/app/core/scoring.py`:
- Base score: `100`
- Speed bonus: `+10` if duration < 300s
- Efficiency penalty: `2 × max(0, commit_count - 20)`
- Final score: clamped at `>= 0`

## Supported bug categories

Core bug type taxonomy (API + fix entries):
- `LINTING`
- `SYNTAX`
- `LOGIC`
- `TYPE_ERROR`
- `IMPORT`
- `INDENTATION`

Each fix row includes:
- file
- bug type
- line number
- commit message
- status (`FIXED`/`FAILED`)
- expected dashboard output string

## Data outputs

At end of a run, backend writes:
- `backend/data/results_<run_id>.json` (historical)
- `backend/data/results.json` (latest snapshot)

These runtime files are ignored by git via `.gitignore`.

## Testing

Existing test scripts in repository root and backend include:
- `test_all_bug_types.py`
- `test_dashboard_scenario.py`
- `test_rift_compliance.py`
- `backend/test_multi_language.py`
- `backend/test_token.py`

Run a sample backend test:

```bash
cd backend
python test_multi_language.py
```

## Troubleshooting

- **Run stuck or fails after push**
	- verify token permissions (`repo`, Actions read)
	- verify target repository allows branch push
- **CI status always failed/unknown**
	- ensure target repo has a workflow that triggers on pushed branch
- **Docker sandbox not used**
	- ensure `docker version` works; otherwise service falls back to direct execution
- **CORS/API errors in frontend**
	- verify `VITE_API_BASE` and backend URL/port

## Additional docs

- [Architecture](docs/ARCHITECTURE.md)
- [API reference](docs/API.md)
- [Development notes](docs/DEVELOPMENT.md)
- [Sandbox execution details](docs/SANDBOX_EXECUTION.md)

